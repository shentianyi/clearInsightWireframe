swagger: '2.0'
info:
  version: 0.0.10
  title: clearinsight web service api
host: '112.124.28.10:8001'
basePath: /api/v2
definitions:
  enum_object:
    type: object
    required:
      - id
      - name
    properties:
      id:
        type: integer
        description: the id of the enum item
      name:
        type: string
        description: the name of the enum item
  user_info:
    description: more detailed user info than brief user info
    type: object
    properties:
      basic_info:
        $ref: '#/definitions/brief_user_info'
  department_member:
    type: object
    properties:
      user:
        $ref: '#/definitions/brief_user_info'
      is_manager:
        type: boolean
        description: is manager of the current department
  alert_head:
    type: object
    properties:
      alert_id:
        type: string
      alert_text:
        type: string
      created_on:
        type: string
      sender:
        type: string
  task_alert:
    type: object
    properties:
      head:
        $ref: '#/definitions/alert_head'
      task_item_id:
        type: string
      task_id:
        type: string
  system_alert:
    type: object
    properties:
      head:
        $ref: '#/definitions/alert_head'
  data_alert:
    type: object
    properties:
      head:
        $ref: '#/definitions/alert_head'
      kpi_id:
        type: string
      department_id:
        type: string
  unread_alert:
    type: object
    properties:
      alert_type:
        type: string
        description: the alert type
        enum:
          - task
          - data
          - system
      count:
        type: number
        description: unread count
  task:
    type: object
    properties:
      taks_id:
        type: string
        description: the task id
      user_id:
        type: string
        description: the user id
      kpi:
        $ref: '#/definitions/kpi'
      department:
        $ref: '#/definitions/department'
      due_flag:
        type: boolean
        description: indicate whether there is task item on this user has due
      assignments:
        type: array
        items:
          $ref: '#/definitions/assignment'
  task_item:
    type: object
    properties:
      task_item_id:
        type: string
        description: the task item id
      task:
        $ref: '#/definitions/task'
        description: the task id
      deadline:
        type: string
        format: date-time
        description: the dealine to finish the task item.
      is_due:
        type: boolean
        description: indicate whether the task item on this user has due
      status:
        type: string
        description: the status of the task
        enum:
          - planned
          - due
          - finish_in_plan
          - finish_after_due
  discussion_comments:
    type: object
    properties:
      discussion_id:
        type: string
        description: the id of the discussion
      comments:
        type: array
        items:
          $ref: '#/definitions/comment'
  comment:
    type: object
    properties:
      id:
        type: string
        description: the id of the comment
      text:
        type: string
        description: the text comment
      evidences:
        description: 'the collection of evidence url (picture, video, snapshot)'
        type: array
        items:
          type: string
      creator:
        description: the creator of the comment
        type: string
      created_on:
        description: the create date on UTC format
        type: string
        format: date-time
  discussion:
    type: object
    properties:
      id:
        type: string
        description: the id of the discussion
      title:
        type: string
        description: "the discussion's title"
      kpi_id:
        type: string
      department_id:
        type: string
      members:
        type: array
        items:
          type: string
      creator:
        type: string
        description: the nick name of the creator
      created_on:
        type: string
        description: the creation date of the discussion under UTC format
      closed_on:
        type: string
        description: the close date of the discussion under UTC format
      status:
        type: string
        description: the status of the discussion
        enum:
          - open
          - closed
  discussion_members:
    type: object
    properties:
      discussion_id:
        type: string
        description: discussion id
      members:
        type: array
        items:
          type: string
        description: array of user id of the members
  data_input:
    type: object
    properties:
      kpi_id:
        type: string
      department_id:
        type: string
      data:
        type: array
        items:
          $ref: '#/definitions/data_entry_with_attributes'
  data_entry:
    type: object
    properties:
      value:
        type: number
        format: float
      time:
        type: string
        format: date-time
        description: UTC time format
  data_entry_with_attributes:
    type: object
    properties:
      value:
        type: number
        format: float
      time:
        type: string
        format: date-time
        description: UTC time format
      attributes:
        type: array
        items:
          $ref: '#/definitions/attribute_value'
        description: the attributes collection
  snapshot:
    type: object
    properties:
      snapshot_id:
        type: string
        description: snapshot ID
      kpi_id:
        type: string
        description: the kpi id of the snapshot
      department_id:
        type: string
        description: the department ID of the snapshot
      kpi_details:
        $ref: '#/definitions/kpi_details'
      created_on:
        type: string
        format: date-time
        description: creation time on UTC format
      created_by:
        $ref: '#/definitions/brief_user_info'
        description: "the creater's information"
  kpi_details:
    type: object
    properties:
      kpi:
        $ref: '#/definitions/kpi'
      alert_text:
        type: string
      current_value:
        type: number
        format: float
      frequency:
        type: string
        description: 'frequency in time span like hour, day, week'
        enum:
          - hour
          - day
          - week
          - month
          - quater
          - year
      calculate_method:
        type: string
        description: the calculate method the system supports
        enum:
          - average
          - accumulate
      from_time:
        type: string
        format: date-time
      end_time:
        type: string
        format: date-time
      department:
        $ref: '#/definitions/department'
      data_entries:
        type: array
        description: sorted by time
        items:
          $ref: '#/definitions/data_entry'
  kpi_aggregative_details:
    type: object
    properties:
      kpi:
        $ref: '#/definitions/kpi'
      alert_text:
        type: string
      current_value:
        type: number
        format: float
      frequency:
        type: string
        description: 'frequency in time span like hour, day, week'
        enum:
          - hour
          - day
          - week
          - month
          - quater
          - year
      calculate_method:
        type: string
        description: the calculate method the system supports
        enum:
          - average
          - accumulate
      from_time:
        type: string
        format: date-time
      end_time:
        type: string
        format: date-time
      department:
        $ref: '#/definitions/department'
      data_entries:
        type: array
        description: sorted by time
        items:
          $ref: '#/definitions/data_entry_with_attributes'
  followed_kpi:
    type: object
    required:
      - user
      - kpi
      - department
      - lower_boundary
      - upper_boundary
      - current_value
    properties:
      user:
        $ref: '#/definitions/brief_user_info'
      kpi:
        $ref: '#/definitions/kpi'
      department:
        $ref: '#/definitions/department'
      lower_boundary:
        type: number
        format: float
      upper_boundary:
        type: number
        format: float
      current_value:
        type: number
        format: float
  created_kpi:
    type: object
    required:
      - user
      - kpi
    properties:
      user:
        $ref: '#/definitions/brief_user_info'
      kpi:
        $ref: '#/definitions/kpi'
  brief_user_info:
    type: object
    required:
      - id
      - email
      - nick_name
      - departments
    properties:
      id:
        type: integer
        description: user resource id
      email:
        type: string
        format: email
        description: user email
      nick_name:
        type: string
        description: the nick name of the user
      departments:
        type: array
        items:
          $ref: '#/definitions/user_on_department'
  user_groups:
    type: object
    required:
      - id
      - name
      - users
    properties:
      id:
        type: integer
        description: the unique user group
      name:
        type: string
        description: the unique list name
      users:
        description: the user_ids in the list
        type: array
        items:
          type: string
  brief_user_group_info:
    type: object
    required:
      - id
      - name
      - user_id
    properties:
      id:
        type: integer
        description: the unique user group
      name:
        type: string
        description: the unique list name
      user_id:
        type: string
        description: user group creator id
  user_group_on_kpi:
    type: object
    required:
      - selected
      - user_group
    properties:
      selected:
        type: boolean
        description: weather the group is selected for the kpi
      user_group:
        $ref: '#/definitions/brief_user_group_info'
        description: user group
  kpi_settings:
    type: object
    required:
      - kpi
      - assignments
    properties:
      kpi:
        $ref: '#/definitions/kpi'
      assignments:
        type: array
        items:
          $ref: '#/definitions/assignment'
  assignment:
    type: object
    required:
      - assignment_id
      - user
      - department_id
      - time
      - frequency
    properties:
      assignment_id:
        type: string
        description: assignment id
      user:
        type: string
        format: email
        description: user id
      department_id:
        type: string
        description: the department id to assign
      time:
        type: string
        description: the time string to remind the user to finish the task
      frequency:
        type: string
        description: the frequency to input the KPI
        enum:
          - hour
          - day
          - week
          - month
          - quater
          - year
  attribute_value:
    properties:
      attribute_id:
        type: string
        description: the attribute ID
      attribute_value:
        type: string
        description: the attribute name
  attribute:
    type: object
    required:
      - attribute_id
      - attribute_name
      - attribute_type
    properties:
      attribute_id:
        type: string
        description: the attribute ID
      attribute_name:
        type: string
        description: the attribute name
      attribute_type:
        type: string
        description: the type of the attributes
        enum:
          - text
          - number
          - location
  attributes_selection:
    type: object
    required:
      - attribute
      - values
    properties:
      attribute:
        $ref: '#/definitions/attribute'
      values:
        type: array
        description: the selected attributes values
        items:
          type: string
  viewable:
    type: object
    required:
      - viewable_code
    properties:
      viewable_code:
        type: string
        description: the viewable type
        enum:
          - private
          - public
          - partial_allow
          - partial_block
      user_group_id:
        type: string
        description: the tagged user group
  return_message:
    type: object
    required:
      - result_code
      - messages
    properties:
      result_code:
        type: string
        description: has enum
        enum:
          - wrong password or user name
          - successfully
      messages:
        type: array
        items:
          type: string
  basic_feedback:
    type: object
    required:
      - result_code
      - need_instruction
    properties:
      result_code:
        type: string
        description: has enum
        enum:
          - wrong password or user name
          - successfully
      messages:
        type: array
        items:
          type: string
      token:
        description: OAuth token getting from the server. May expire based on the web service settings. Need to attach the token to the http head each time invoking the api
        type: string
      need_instruction:
        description: a flag to show the page id that the user has not entered in order the
        type: boolean
      customized_field:
        description: a customized field for different invoke
        type: object
  kpi:
    type: object
    required:
      - kpi_id
      - kpi_name
      - description
      - creator
      - created_on
      - target_max
      - target_min
      - uom
      - calculate_method
      - viewable
    properties:
      kpi_id:
        type: string
        description: the kpi unique key
      kpi_name:
        type: string
        description: the kpi name
      description:
        type: string
        description: the description of the KPI
      creator:
        type: string
        description: "the creator's nick name"
      created_on:
        type: string
        description: the creation time in UTC format
      target_max:
        type: number
        description: the default max target
      target_min:
        type: number
        format: float
        description: the default min target
      uom:
        type: string
        description: the unit of measurement code
      calculate_method:
        type: string
        description: the calculate methode code of the kpi
      viewable:
        $ref: '#/definitions/viewable'
      attributes:
        type: array
        description: the attributes
        items:
          $ref: '#/definitions/attribute'
  department:
    type: object
    properties:
      id:
        type: integer
        description: "the department's id"
      name:
        type: string
        description: the department name
      description:
        type: string
        description: the department description
      parent_id:
        type: integer
        description: 'the parent department id, null if current department is the top department of the user'
      has_children:
        type: boolean
        description: flag to indicate whether it has chilren department
  user_on_department:
    type: object
    properties:
      managable:
        type: boolean
        description: indicate user manage rigth to the department
      department:
        $ref: '#/definitions/department'
        description: the departments
  department_follow_status:
    type: object
    required:
      - department
      - follow_flag
    properties:
      follow_flag:
        type: string
        description: indicate the follow status of the user to the kpi
        enum:
          - NONE
          - PARTLY
          - ALL
          - NA
      department:
        $ref: '#/definitions/department'
        description: the departments
  user_kpi_on_departments:
    type: object
    required:
      - department_follow_states
      - kpi
      - user
    properties:
      user:
        $ref: '#/definitions/brief_user_info'
        description: the user
      department_follow_states:
        type: array
        items:
          $ref: '#/definitions/department_follow_status'
        description: the departments
      kpi:
        $ref: '#/definitions/kpi'
        description: the kp
  kpi_on_user:
    type: object
    required:
      - user
      - kpi
      - follow_flag
    properties:
      user:
        $ref: '#/definitions/brief_user_info'
        description: the user
      kpi:
        $ref: '#/definitions/kpi'
        description: the kpi desc
      follow_flag:
        type: string
        description: indicate the follow status of the user to the kpi
        enum:
          - NONE
          - PARTLY
          - ALL
          - NA
      is_created:
        type: boolean
        description: indicate whether the KPI is created by current user
      is_managable:
        type: boolean
        description: indicate whether the user has the authorization to manage the KPI
paths:
  /user_sessions:
    post:
      description: User Sign In for external app invoke
      parameters:
        - name: email
          in: query
          description: user email
          required: true
          type: string
        - name: password
          in: query
          description: user password
          required: true
          type: string
        - name: Accept-Language
          in: header
          description: 'the language code of the current user environment. zh, en, de are allowed.'
          required: true
          type: string
      responses:
        '201':
          description: Successful response
          schema:
            $ref: '#/definitions/basic_feedback'
  /user_registrations:
    post:
      description: User Sign Up Api
      parameters:
        - name: email
          in: query
          description: user email
          required: true
          type: string
        - name: password
          in: query
          description: user password
          required: true
          type: string
        - name: nick_name
          in: query
          description: user nick name
          required: true
          type: string
        - name: Accept-Language
          in: header
          description: 'the language code of the current user environment. zh, en, de are allowed.'
          required: true
          type: string
      responses:
        '201':
          description: Successful response
          schema:
            $ref: '#/definitions/return_message'
  /users/brief_infos:
    get:
      description: get user list
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: 'the oauth token from the server, type is beare'
          required: true
          type: string
        - name: page
          in: query
          type: integer
          description: 'page index of request the list, start from 0'
        - name: size
          in: query
          type: integer
          description: 'page size of request the list, default is 20'
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/brief_user_info'
        '403':
          description: indicate the token or user session has expired
  /users/infos:
    get:
      description: get user account settings
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: user_id
          in: query
          type: string
          description: user account id
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/user_info'
        '403':
          description: indicate the token or user session has expired
    post:
      description: create user account
      parameters:
        - name: user_info
          in: body
          description: user name to register
          required: true
          schema:
            $ref: '#/definitions/user_info'
        - name: password
          in: query
          description: user password
          required: true
          type: string
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/basic_feedback'
    put:
      description: update user account
      parameters:
        - name: nick_name
          in: body
          description: user nick name
          required: true
          type: string
        - name: email
          in: body
          description: user email
          required: true
          type: string
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/basic_feedback'
  /users/set_password:
    post:
      description: change a user password
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: old_password
          in: query
          type: string
          description: the current password
        - name: new_password
          required: true
          in: query
          type: string
          description: new password
        - name: user_id
          in: query
          type: string
          description: user to change password
      responses:
        '201':
          description: Successful response
          schema:
            $ref: '#/definitions/basic_feedback'
        '403':
          description: indicate the token or user session has expired
  /users/forget_password:
    post:
      description: user forget password api
      parameters:
        - name: email
          in: body
          description: user email
          required: true
          type: string
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
      responses:
        '201':
          description: Successful response
          schema:
            $ref: '#/definitions/return_message'
        '403':
          description: indicate the token or user session has expired
  /departments:
    post:
      description: create department
      parameters:
        - name: name
          in: body
          description: department name
          required: true
          type: string
        - name: description
          in: body
          description: department description
          required: true
          type: string
        - name: parent_id
          in: body
          description: department parent id
          required: true
          type: integer
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
      responses:
        '201':
          description: Successful response
          schema:
            $ref: '#/definitions/basic_feedback'
        '403':
          description: indicate the token or user session has expired
    put:
      description: update department
      parameters:
        - name: name
          in: body
          description: department name
          required: true
          type: string
        - name: description
          in: body
          description: department description
          required: true
          type: string
        - name: id
          in: body
          description: department id
          required: true
          type: integer
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/basic_feedback'
        '403':
          description: indicate the token or user session has expired
    delete:
      description: deelte department
      parameters:
        - name: id
          in: query
          description: department id
          required: true
          type: integer
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/return_message'
        '403':
          description: indicate the token or user session has expired
  /departments/add_users:
    post:
      description: add users to department with user emails
      parameters:
        - name: id
          in: body
          required: true
          type: integer
          description: department id
        - name: emails
          required: true
          in: body
          type: array
          description: user emails
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
      responses:
        '201':
          description: Successful response
          schema:
            $ref: '#/definitions/return_message'
        '403':
          description: indicate the token or user session has expired
  /departments/remove_user:
    post:
      description: remove user from the department
      parameters:
        - name: id
          in: body
          required: true
          type: integer
          description: department id
        - name: user_id
          required: true
          in: body
          type: integer
          description: user id
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
      responses:
        '201':
          description: Successful response
          schema:
            $ref: '#/definitions/return_message'
        '403':
          description: indicate the token or user session has expired
  /users/departments:
    get:
      description: get all the departments the user has access on one level.
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: department_id
          in: query
          type: integer
          description: 'the parent department ID. If the department ID is null, return the top level of departments'
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/user_on_department'
        '403':
          description: indicate the token or user session has expired
  /departments/members:
    get:
      description: get all the members of a departmment node
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: id
          in: query
          type: integer
          description: department to get the members
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/department_member'
        '403':
          description: indicate the token or user session has expired
  /departments/set_manager:
    post:
      description: set a user as department manager
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: id
          in: query
          type: integer
          required: true
          description: department need to set manager
        - name: user_id
          in: query
          type: integer
          required: true
          description: manager to be
      responses:
        '201':
          description: Successful response
          schema:
            $ref: '#/definitions/return_message'
        '403':
          description: indicate the token or user session has expired
  /departments/remove_manager:
    post:
      description: unset a user from department manager
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: id
          in: query
          type: integer
          required: true
          description: department need to set manager
        - name: user_id
          in: query
          type: integer
          required: true
          description: manager to be
      responses:
        '201':
          description: Successful response
          schema:
            $ref: '#/definitions/return_message'
        '403':
          description: indicate the token or user session has expired
  /kpis/unit_of_measurements:
    get:
      description: get the list
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
      responses:
        '200':
          description: successful
          schema:
            type: array
            items:
              $ref: '#/definitions/enum_object'
        '403':
          description: indicate the token or user session has expired
  /kpis/calculate_methods:
    get:
      description: get the list
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
      responses:
        '200':
          description: successful
          schema:
            type: array
            items:
              $ref: '#/definitions/enum_object'
        '403':
          description: indicate the token or user session has expired
  /kpis/timing_frequencies:
    get:
      description: get the list
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
      responses:
        '200':
          description: successful
          schema:
            type: array
            items:
              $ref: '#/definitions/enum_object'
        '403':
          description: indicate the token or user session has expired
  /kpis/users/accesses:
    get:
      description: get all the kpis the user has access.
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: page
          in: query
          type: integer
          description: 'page index of request the list, start from 0'
        - name: size
          in: query
          type: integer
          description: 'page size of request the list, default is 20'
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/kpi_on_user'
        '403':
          description: indicate the token or user session has expired
  /kpis/users/followed:
    get:
      description: get followed KPI by current user
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: page
          in: query
          type: integer
          description: 'page index of request the list, start from 0'
        - name: size
          in: query
          type: integer
          description: 'page size of request the list, default is 20'
      responses:
        '200':
          description: successful
          schema:
            type: array
            items:
              $ref: '#/definitions/kpi_on_user'
        '403':
          description: indicate the token or user session has expired
  /kpis/users/created:
    get:
      description: get created KPI by current user
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: page
          in: query
          type: integer
          description: 'page index of request the list, start from 0'
        - name: size
          in: query
          type: integer
          description: 'page size of request the list, default is 20'
      responses:
        '200':
          description: successful
          schema:
            type: array
            items:
              $ref: '#/definitions/kpi_on_user'
        '403':
          description: indicate the token or user session has expired
  /kpis/departments:
    get:
      description: get department in the access of the user
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: department_id
          in: query
          description: 'the start department id, if null, return the top levels of departments of the user access'
          required: true
          type: string
      responses:
        '200':
          description: ok
          schema:
            $ref: '#/definitions/user_kpi_on_departments'
        '403':
          description: indicate the token or user session has expired
  /kpis/follow:
    post:
      description: follow a kpi under certain department
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: kpi_id
          description: the kpi id to follow
          in: query
          required: true
          type: string
        - name: department_id
          in: query
          description: the department to follow
          required: true
          type: string
        - name: lower_boundary
          in: query
          description: the lower boundary for notification
          required: true
          type: number
          format: float
        - name: upper_boundary
          in: query
          description: the upper boundary for notification
          required: true
          type: number
          format: float
        - name: auto_notification
          in: query
          description: "whether receive auto notification for this following when the kpi is abnormal(exceed the upper and lower boundary's value)"
          required: true
          type: boolean
      responses:
        '200':
          description: successful
          schema:
            $ref: '#/definitions/return_message'
        '403':
          description: indicate the token or user session has expired
  /kpis/unfollow:
    post:
      description: unfollow a kpi under certain department
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: kpi_id
          description: the kpi id to unfollow
          in: query
          required: true
          type: string
        - name: department_id
          in: query
          description: the department to unfollow
          required: true
          type: string
      responses:
        '200':
          description: successful
          schema:
            $ref: '#/definitions/return_message'
        '403':
          description: indicate the token or user session has expired
  /kpis:
    get:
      description: get a kpi with an ID
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: kpi_id
          in: query
          required: true
          type: string
      responses:
        '200':
          description: successful
          schema:
            $ref: '#/definitions/kpi_settings'
        '403':
          description: indicate the token or user session has expired
    post:
      description: create a kpi
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: kpi
          in: body
          description: the kpi name to create.
          required: true
          schema:
            $ref: '#/definitions/kpi_settings'
      responses:
        '200':
          description: successful
          schema:
            $ref: '#/definitions/basic_feedback'
        '403':
          description: indicate the token or user session has expired
    put:
      description: update a kpi
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: kpi
          in: body
          description: the kpi name to create.
          required: true
          schema:
            $ref: '#/definitions/kpi_settings'
      responses:
        '200':
          description: successful
          schema:
            $ref: '#/definitions/basic_feedback'
        '403':
          description: indicate the token or user session has expired
  /user_groups:
    post:
      description: create a user group list
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: user_group_list
          in: body
          description: the user group list object to create
          required: true
          schema:
            $ref: '#/definitions/user_groups'
      responses:
        '200':
          description: successful
          schema:
            $ref: '#/definitions/basic_feedback'
        '403':
          description: indicate the token or user session has expired
    put:
      description: update a user group list
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: user_groups
          in: body
          description: the user group list object to update
          required: true
          schema:
            $ref: '#/definitions/user_groups'
      responses:
        '200':
          description: successful
          schema:
            $ref: '#/definitions/basic_feedback'
        '403':
          description: indicate the token or user session has expired
    get:
      description: get a user group list
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: id
          in: query
          description: the user group id
          required: true
          type: string
      responses:
        '200':
          description: successful
          schema:
            type: array
            items:
              $ref: '#/definitions/user_groups'
        '403':
          description: indicate the token or user session has expired
  /user_groups/for_kpis:
    get:
      description: get the user list with full text method
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: kpi_id
          in: query
          description: kpi id
          required: true
          type: string
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/user_group_on_kpi'
        '403':
          description: indicate the token or user session has expired
  /search/full_text/users:
    get:
      description: get the user list with full text method
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: input_chars
          in: query
          type: string
          description: the characters the user input
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/brief_user_info'
        '403':
          description: indicate the token or user session has expired
  /search/full_text/departments:
    get:
      description: get the department list with full text method
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: input_chars
          in: query
          type: string
          description: the characters the user input
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/department'
        '403':
          description: indicate the token or user session has expired
  /search/full_text/kpis:
    get:
      description: "get the user's followable kpi list with full text method"
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: input_chars
          in: query
          type: string
          description: the characters the user input
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/kpi_on_user'
        '403':
          description: indicate the token or user session has expired
  /search/full_text/followed_kpis:
    get:
      description: "get the user's following kpi list with full text method"
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: input_chars
          in: query
          type: string
          description: the characters the user input
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/followed_kpi'
        '403':
          description: indicate the token or user session has expired
  /kpis/details:
    get:
      description: get kpi performance of a department during a time span with a calculate method
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: kpi_id
          in: query
          type: string
          description: the kpi id
        - name: department_id
          in: query
          type: string
          description: the department id
        - name: frequency
          in: query
          type: string
          description: the frequency of time span
          enum:
            - hour
            - day
            - week
            - month
            - quater
            - year
        - name: calculate_method
          in: query
          type: string
          description: the calculate method to summerize the data
          enum:
            - average
            - accumulate
        - name: from_time
          in: query
          type: string
          description: the start point of the time span
          format: date-time
        - name: end_time
          in: query
          type: string
          description: the end point of the time span
          format: date-time
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/kpi_details'
        '403':
          description: indicate the token or user session has expired
  /discussions:
    get:
      description: get the discussion list or discussion by ID
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: kpi_id
          in: query
          type: string
          description: the related KPI ID
        - name: department_id
          in: query
          type: string
          description: the related department ID
        - name: discussion_id
          in: query
          type: string
          description: 'the discussion id. if not null, only return the single discussion or empty array. If null, return all the list'
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/discussion'
        '403':
          description: indicate the token or user session has expired
    post:
      description: create a discussion
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: discussion
          in: body
          schema:
            $ref: '#/definitions/discussion'
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/basic_feedback'
        '403':
          description: indicate the token or user session has expired
  /discussion_members:
    get:
      description: get the member list of a discussion
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: discussion_id
          in: query
          description: the discussion id
          type: string
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/brief_user_info'
        '403':
          description: indicate the token or user session has expired
    post:
      description: update the list of members in a discussion
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: discussion_members
          in: body
          schema:
            $ref: '#/definitions/discussion_members'
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/basic_feedback'
        '403':
          description: indicate the token or user session has expired
  /discussion_comments:
    get:
      description: get comments of a discussion
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: discussion_id
          in: query
          description: the discussion id of the comments
          type: string
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/comment'
        '403':
          description: indicate the token or user session has expired
    post:
      description: add a comment to a discussion
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: discussion_comment
          in: body
          description: the discussion to add the comment
          schema:
            $ref: '#/definitions/discussion_comments'
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/basic_feedback'
        '403':
          description: indicate the token or user session has expired
  /comments:
    get:
      description: get a comment with id
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: comment_id
          in: query
          description: the discussion to add the comment
          type: string
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/comment'
        '403':
          description: indicate the token or user session has expired
  /aggregative_analysis:
    get:
      description: make an aggregative analysis
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: kpi_id
          in: query
          type: string
          description: the kpi id
        - name: department_id
          in: query
          type: string
          description: the department id
        - name: frequency
          in: query
          type: string
          description: the frequency of time span
          enum:
            - hour
            - day
            - week
            - month
            - quater
            - year
        - name: calculate_method
          in: query
          type: string
          description: the calculate method to summerize the data
          enum:
            - average
            - accumulate
        - name: from_time
          in: query
          type: string
          description: the start point of the time span
          format: date-time
        - name: end_time
          in: query
          type: string
          description: the end point of the time span
          format: date-time
        - name: attributes
          in: body
          schema:
            type: array
            items:
              $ref: '#/definitions/attributes_selection'
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/kpi_aggregative_details'
        '403':
          description: indicate the token or user session has expired
  /snapshot:
    get:
      description: get the snapshot by it
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: snapshot_id
          in: query
          description: the snapshot id
          type: string
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/snapshot'
        '403':
          description: indicate the token or user session has expired
    post:
      description: post a snapshot to a discussion as comment
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: kpi_details
          in: body
          description: the KPI performance of current query
          schema:
            $ref: '#/definitions/kpi_details'
        - name: discussion_id
          in: query
          type: string
          description: the discussion to add in
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/basic_feedback'
        '403':
          description: indicate the token or user session has expired
  /upload_attachment:
    post:
      description: upload a file
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: file
          in: query
          description: the file to upload.
          type: string
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/basic_feedback'
            description: in customized field set the url where the attachment uploaded stored
        '403':
          description: indicate the token or user session has expired
  /tasks:
    get:
      description: get task by task id
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: task_id
          in: query
          description: the task id to receive the task
          type: string
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/task'
            description: the task with the id
        '403':
          description: indicate the token or user session has expired
  /user_tasks:
    get:
      description: get user tasks
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: user_id
          in: query
          description: the user id to receive the task
          type: string
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/task'
            description: the tasks the user are assigned
        '403':
          description: indicate the token or user session has expired
    post:
      description: further assign a task to a user
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: assignments
          in: body
          description: the assignments
          schema:
            type: array
            items:
              $ref: '#/definitions/assignment'
        - name: task_id
          in: query
          description: the task id to further assign
          type: string
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/basic_feedback'
            description: the result
        '403':
          description: indicate the token or user session has expired
  /task_items:
    get:
      description: get task items by task id
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: task_id
          in: query
          description: the task id to receive the task
          type: string
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/task_item'
        '403':
          description: indicate the token or user session has expired
  /input_data:
    post:
      description: enter a kpi data
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: task_item_id
          in: query
          required: false
          description: the task item id to receive the data in case the user enter the data via a task. could be null if it is a manual input
          type: string
        - name: data
          in: body
          schema:
            $ref: '#/definitions/data_input'
      responses:
        '200':
          description: Successful response
          schema:
            $ref: '#/definitions/basic_feedback'
        '403':
          description: indicate the token or user session has expired
  /user_alert_count:
    get:
      description: get alerts of a user
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: user_id
          in: query
          description: the user need to get alerts
          type: string
        - name: only_unread
          in: query
          description: whether get only unread alert
          type: boolean
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/unread_alert'
        '403':
          description: indicate the token or user session has expired
  /task_alerts:
    get:
      description: get task alerts of a user
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: user_id
          in: query
          description: the user need to get alerts
          type: string
        - name: only_unread
          in: query
          description: whether get only unread alert
          type: boolean
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/task_alert'
        '403':
          description: indicate the token or user session has expired
  /system_alerts:
    get:
      description: get alerts of a user
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: user_id
          in: query
          description: the user need to get alerts
          type: string
        - name: only_unread
          in: query
          description: whether get only unread alert
          type: boolean
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/system_alert'
        '403':
          description: indicate the token or user session has expired
  /data_alerts:
    get:
      description: get alerts of a user
      parameters:
        - name: Accept-Language
          in: header
          description: the language code of the current user environment
          required: true
          type: string
        - name: Authorization
          in: header
          description: the oauth token from the server
          required: true
          type: string
        - name: user_id
          in: query
          description: the user need to get alerts
          type: string
        - name: only_unread
          in: query
          description: whether get only unread alert
          type: boolean
      responses:
        '200':
          description: Successful response
          schema:
            type: array
            items:
              $ref: '#/definitions/data_alert'
        '403':
          description: indicate the token or user session has expired
